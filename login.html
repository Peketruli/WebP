<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Login / Registro</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body {
    font-family: Arial; 
    text-align:center; 
    padding:50px; 
    background: linear-gradient(45deg,#FF5733,#FFC300,#FF5733); 
    color:white;
}
.container { 
    background:white; 
    padding:20px; 
    border-radius:10px; 
    display:inline-block; 
    color:black; 
}
input, button { 
    display:block; 
    margin:10px auto; 
    padding:10px; 
    width:80%; 
}
#error-message { 
    color:red; 
    font-size:0.9em; 
}
</style>
</head>
<body>
<div class="container">
    <h2 id="formTitle">Iniciar Sesión</h2>
    <input type="text" id="username" placeholder="Nombre de usuario">
    <input type="password" id="password" placeholder="Contraseña">

    <button id="toggleRegister">Registrarse</button>
    <button id="submitButton">Iniciar Sesión</button>

    <div id="error-message"></div>
</div>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let isRegistering = false;

// Alternar registro/login
document.getElementById("toggleRegister").addEventListener("click", () => {
    isRegistering = !isRegistering;
    document.getElementById("formTitle").textContent = isRegistering ? "Registrarse" : "Iniciar Sesión";
    document.getElementById("submitButton").textContent = isRegistering ? "Registrar" : "Iniciar Sesión";
    document.getElementById("error-message").textContent = '';
});

// Registrar / iniciar sesión
document.getElementById("submitButton").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) { 
        document.getElementById("error-message").textContent = "Completa todos los campos."; 
        return; 
    }

    if (isRegistering) {
        // Verificar si username ya existe
        const { data: existingUser, error: selectError } = await supabase
            .from("users")
            .select("id")
            .eq("username", username)
            .single();

        if (existingUser) {
            document.getElementById("error-message").textContent = "El nombre de usuario ya existe.";
            return;
        }

        // Insertar nuevo usuario
        const { data, error: insertError } = await supabase
            .from("users")
            .insert([{ username, password }]);

        if (insertError) {
            document.getElementById("error-message").textContent = insertError.message;
            return;
        }

        alert("Registro exitoso. Ya puedes iniciar sesión.");
        isRegistering = false;
        document.getElementById("formTitle").textContent = "Iniciar Sesión";
        document.getElementById("submitButton").textContent = "Iniciar Sesión";
        document.getElementById("error-message").textContent = '';
    } else {
        // Iniciar sesión
        const { data: user, error: loginError } = await supabase
            .from("users")
            .select("*")
            .eq("username", username)
            .eq("password", password)
            .single();

        if (!user || loginError) {
            document.getElementById("error-message").textContent = "Usuario o contraseña incorrectos.";
            return;
        }

        // Guardar sesión
        localStorage.setItem("currentUser", JSON.stringify(user));
        alert("Inicio de sesión exitoso");
        window.location.href = "PaginaPrincipal.html";
    }
});
</script>
</body>
</html>
