<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Blog - Rebeldía IN.AR</title>
  <style>
    body {
      background: linear-gradient(45deg, #FF5733, #FF8D1A, #FFC300, #FF5733);
      background-size: 400% 400%;
      animation: gradientBG 10s ease infinite;
      font-family: Arial, sans-serif;
      color: black;
      margin: 0;
      padding: 0;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    header {
      padding: 20px;
      text-align: center;
      color: white;
    }

    .container {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
    }

    .blog-post {
      background: white;
      color: black;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .blog-post h3 {
      margin-top: 0;
    }

    .button {
      display: inline-block;
      padding: 10px 15px;
      margin: 10px 0;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
    }

    .button:hover {
      background-color: #0056b3;
    }

    #newPostForm {
      display: none;
      margin-bottom: 20px;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }

    #newPostForm input, #newPostForm textarea {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Blog Rebeldía IN.AR</h1>
    <button class="button" onclick="window.location.href='index.html'">⬅ Volver a la página principal</button>
    <button id="publishBtn" class="button" style="display:none;" onclick="togglePostForm()">✍ Publicar blog</button>
  </header>

  <div class="container">
    <!-- Formulario para nuevo post -->
    <div id="newPostForm">
      <h3>Escribe un nuevo blog</h3>
      <input type="text" id="title" placeholder="Título del blog">
      <textarea id="content" rows="5" placeholder="Contenido del blog"></textarea>
      <button class="button" onclick="publishPost()">Publicar</button>
    </div>

    <!-- Contenedor de blogs -->
    <div id="blogContainer"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const user = JSON.parse(localStorage.getItem("currentUser"));
      if (user) {
        document.getElementById("publishBtn").style.display = "inline-block";
      }
      loadBlogs();
    });

    function togglePostForm() {
      const form = document.getElementById("newPostForm");
      form.style.display = (form.style.display === "block") ? "none" : "block";
    }

    async function loadBlogs() {
      try {
        let response = await fetch("backend_blog.php?action=get");
        let blogs = await response.json();

        const container = document.getElementById("blogContainer");
        container.innerHTML = "";

        blogs.forEach(blog => {
          const div = document.createElement("div");
          div.classList.add("blog-post");
          div.innerHTML = `
            <h3>${blog.titulo}</h3>
            <p>${blog.contenido}</p>
            <small>Autor: ${blog.autor}</small>
          `;
          container.appendChild(div);
        });
      } catch (error) {
        console.error("Error cargando blogs:", error);
      }
    }

    async function publishPost() {
      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      const user = JSON.parse(localStorage.getItem("currentUser"));

      if (!title || !content) {
        alert("Por favor rellena todos los campos.");
        return;
      }

      try {
        let response = await fetch("backend_blog.php?action=add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            titulo: title,
            contenido: content,
            autor: user.username
          })
        });

        if (response.ok) {
          alert("Blog publicado con éxito.");
          document.getElementById("title").value = "";
          document.getElementById("content").value = "";
          togglePostForm();
          loadBlogs();
        } else {
          alert("Error publicando el blog.");
        }
      } catch (error) {
        console.error("Error:", error);
      }
    }
  </script>
</body>
</html>
