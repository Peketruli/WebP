<head>
    <title>Blog</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { background: linear-gradient(45deg, #FF5733, #FF8D1A, #FFC300, #FF5733); background-size: 400% 400%; animation: gradientBG 10s ease infinite; color: #000; font-family: Arial; text-align: center; padding: 50px; margin-bottom: 100px; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .blog-container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); text-align: center; }
        .blog-list { margin-top: 20px; }
        .blog-post { border: 1px solid #ddd; padding: 10px; margin: 10px 0; cursor: pointer; background: #f9f9f9; border-radius: 5px; }
        .hidden { display: none; }
        .blog-form { margin-top: 20px; }
        .blog-details { padding: 20px; background: white; margin-top: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .comment-section { margin-top: 20px; text-align: left; }
        .warning-message { color: red; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="blog-container">
        <h2>Crear Blog</h2>
        <button id="toggleBlogButton">✏️ Crear Blog</button>

        <div id="blogForm" class="blog-form hidden">
            <input type="text" id="blogTitle" placeholder="Título del blog" style="width:100%; padding:8px;">
            <textarea id="blogContent" placeholder="Escribe aquí..." style="width:100%; height:100px; padding:8px;"></textarea>
            <input type="file" id="blogMedia" accept="image/*,video/*">
            <button id="publishButton">Publicar</button>
        </div>

        <div id="blogsList" class="blog-list"></div>
        <div id="blogDetails" class="blog-details hidden"></div>
        <div id="warningMessage" class="warning-message hidden">¡Debes iniciar sesión para crear un blog o comentar!</div>
    </div>

    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
        const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
        const SUPABASE_KEY = "TU_SUPABASE_KEY";
        window.supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        function getCurrentUser() { return JSON.parse(localStorage.getItem("currentUser")) || {}; }
        function isUserLoggedIn() { return !!getCurrentUser().username; }

        async function publishBlog() {
            if (!isUserLoggedIn()) { document.getElementById("warningMessage").classList.remove("hidden"); return; }
            document.getElementById("warningMessage").classList.add("hidden");

            const title = document.getElementById("blogTitle").value;
            const content = document.getElementById("blogContent").value;
            const user = getCurrentUser();

            if (!title || !content) { alert("Completa título y contenido"); return; }

            const { error } = await supabase.from("blogs").insert([{ title, content, author: user.username || "Anónimo", comments: [] }]);
            if (error) { console.error(error); alert("Error al publicar"); }
            else { alert("Blog publicado!"); location.reload(); }
        }

        function toggleBlogForm() {
            if (!isUserLoggedIn()) { document.getElementById("warningMessage").classList.remove("hidden"); return; }
            document.getElementById("warningMessage").classList.add("hidden");
            document.getElementById("blogForm").classList.toggle("hidden");
        }

        window.addEventListener("DOMContentLoaded", () => {
            document.getElementById("toggleBlogButton").addEventListener("click", toggleBlogForm);
            document.getElementById("publishButton").addEventListener("click", publishBlog);
        });
    </script>
</body>
